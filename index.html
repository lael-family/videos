<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Custom Video Player â€” Google Drive</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0f1115;
      --fg: #e8eaf0;
      --muted: #9aa3b2;
      --accent: #4f8cff;
      --rail: #2a2f3a;
      --rail-fill: #6aa1ff;
      --danger: #ff6b6b;
      --card: #151924;
    }

    .light {
      --bg: #f6f7fb;
      --fg: #0d1021;
      --muted: #5a6170;
      --accent: #2d6df6;
      --rail: #d5d9e3;
      --rail-fill: #2d6df6;
      --card: #ffffff;
    }

    html,
    body {
      height: 100%
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font: 14px/1.4 system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      display: grid;
      place-items: center;
      padding: 16px;
    }

    .wrap {
      width: min(100%, 980px)
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      gap: 12px;
    }

    .header h1 {
      font-size: 16px;
      margin: 0;
      color: var(--muted);
      font-weight: 600
    }

    .toggle {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      user-select: none;
      cursor: pointer;
      color: var(--muted);
    }

    .player {
      background: var(--card);
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, .25);
      position: relative;
    }

    video {
      width: 100%;
      background: black;
      display: block
    }

    .controls {
      position: absolute;
      inset: auto 0 0 0;
      background: linear-gradient(180deg, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, .55) 45%, rgba(0, 0, 0, .7) 100%);
      color: #fff;
      padding: 10px;
      transition: opacity .25s ease;
      opacity: 1;
    }

    .player.hide-ui .controls {
      opacity: 0;
      pointer-events: none
    }

    .row {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap
    }

    .bar {
      width: 100%;
      height: 6px;
      background: var(--rail);
      border-radius: 999px;
      position: relative;
      cursor: pointer;
    }

    .bar .load {
      position: absolute;
      height: 100%;
      background: #8aa7;
      border-radius: 999px;
      width: 0%
    }

    .bar .fill {
      position: absolute;
      height: 100%;
      background: var(--rail-fill);
      border-radius: 999px;
      width: 0%
    }

    .btn {
      display: inline-grid;
      place-items: center;
      width: 36px;
      height: 36px;
      border-radius: 8px;
      background: #ffffff10;
      color: #fff;
      border: 0;
      cursor: pointer;
      transition: background .15s ease;
    }

    .btn:hover {
      background: #ffffff20
    }

    .time,
    .speed {
      color: #fff;
      font-variant-numeric: tabular-nums;
      opacity: .9;
    }

    .spacer {
      flex: 1
    }

    .range {
      appearance: none;
      width: 120px;
      height: 6px;
      background: var(--rail);
      border-radius: 999px;
      outline: none
    }

    .range::-webkit-slider-thumb {
      appearance: none;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: var(--accent);
      cursor: pointer
    }

    .range::-moz-range-thumb {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: var(--accent);
      border: 0;
      cursor: pointer
    }

    .notice {
      margin-top: 10px;
      color: var(--muted);
      font-size: 12px;
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0
    }
  </style>
</head>

<body class="">
  <div class="wrap">
    <div class="header">
      <h1>Custom Video Player (Google Drive)</h1>
      <label class="toggle">
        <input id="themeToggle" type="checkbox" />
        <span>Light mode</span>
      </label>
    </div>

    <div class="player" id="player">
      <!--
        NOTE:
        1) Replace DRIVE_FILE_ID with your fileâ€™s ID.
        2) File must be publicly accessible (Anyone with link â€“ Viewer).
        3) Some Drive files wonâ€™t stream due to CORS/confirm token. If so, use the preview iframe or host elsewhere.
      -->
      <video id="video" preload="metadata" playsinline></video>

      <div class="controls" id="controls">
        <div class="row" style="margin-bottom:8px">
          <div class="bar" id="seekBar" aria-label="Seek">
            <div class="load" id="loadBar"></div>
            <div class="fill" id="fillBar"></div>
          </div>
        </div>
        <div class="row">
          <button class="btn" id="playBtn" aria-label="Play/Pause">â–¶</button>
          <span class="time" id="timeLabel">00:00 / 00:00</span>

          <div class="spacer"></div>

          <span class="time">Vol</span>
          <input class="range" id="vol" type="range" min="0" max="1" step="0.01" value="1" aria-label="Volume" />

          <button class="btn" id="muteBtn" aria-label="Mute/Unmute">ðŸ”ˆ</button>

          <span class="speed">
            <label class="sr-only" for="rate">Speed</label>
            <select id="rate" aria-label="Playback speed"
              style="background:#ffffff10;color:#fff;border:0;padding:8px;border-radius:8px">
              <option value="0.5">0.5Ã—</option>
              <option value="0.75">0.75Ã—</option>
              <option value="1" selected>1Ã—</option>
              <option value="1.25">1.25Ã—</option>
              <option value="1.5">1.5Ã—</option>
              <option value="1.75">1.75Ã—</option>
              <option value="2">2Ã—</option>
            </select>
          </span>

          <button class="btn" id="ccBtn" aria-label="Captions">CC</button>
          <button class="btn" id="fsBtn" aria-label="Fullscreen">â¤¢</button>
        </div>
      </div>
    </div>

    <p class="notice">
      If playback fails: confirm the file is public and try smaller files.
      Fallback: use Drive preview iframe â€” <code>https://drive.google.com/file/DRIVE_FILE_ID/preview</code>.
    </p>
  </div>

  <script>
    // ====== CONFIG ======
    // From your link: https://drive.google.com/file/d/1C8TSynmUZZWUUEae6KFdtbipqyE2yAa-/view?usp=drive_link
    const DRIVE_FILE_ID = "1C8TSynmUZZWUUEae6KFdtbipqyE2yAa-";

    // Attempt direct stream endpoint (works only when Google serves video bytes without confirm interstitial)
    const driveDirect = `https://drive.google.com/uc?export=download&id=${DRIVE_FILE_ID}`;

    // Optional fallback (Drive preview UI inside cross-origin iframe; cannot be controlled by our JS):
    const drivePreview = `https://drive.google.com/file/d/${DRIVE_FILE_ID}/preview`;

    // ====== ELEMENTS ======
    const body = document.body;
    const video = document.getElementById('video');
    const player = document.getElementById('player');
    const controls = document.getElementById('controls');
    const playBtn = document.getElementById('playBtn');
    const fsBtn = document.getElementById('fsBtn');
    const muteBtn = document.getElementById('muteBtn');
    const vol = document.getElementById('vol');
    const rate = document.getElementById('rate');
    const ccBtn = document.getElementById('ccBtn');
    const seekBar = document.getElementById('seekBar');
    const fillBar = document.getElementById('fillBar');
    const loadBar = document.getElementById('loadBar');
    const timeLabel = document.getElementById('timeLabel');
    const themeToggle = document.getElementById('themeToggle');

    // ====== INIT ======
    (function init() {
      // Try to use direct stream
      video.src = driveDirect;
      video.controls = false; // weâ€™re using custom controls
      video.addEventListener('error', onStreamError, {once: true});

      // Keyboard shortcuts
      window.addEventListener('keydown', onKey);

      // Hide controls when idle
      let uiTimer;
      const resetUI = () => {
        player.classList.remove('hide-ui');
        clearTimeout(uiTimer);
        uiTimer = setTimeout(() => player.classList.add('hide-ui'), 2500);
      };
      ['mousemove', 'touchstart'].forEach(evt => player.addEventListener(evt, resetUI));
      resetUI();
    })();

    // ====== EVENTS ======
    playBtn.addEventListener('click', togglePlay);
    video.addEventListener('click', togglePlay);
    video.addEventListener('play', updatePlayIcon);
    video.addEventListener('pause', updatePlayIcon);
    video.addEventListener('timeupdate', updateProgress);
    video.addEventListener('progress', updateBuffered);
    video.addEventListener('loadedmetadata', updateTimes);
    video.addEventListener('ratechange', () => rate.value = String(video.playbackRate));

    vol.addEventListener('input', () => {
      video.volume = parseFloat(vol.value);
      video.muted = video.volume === 0;
      updateMuteIcon();
    });
    muteBtn.addEventListener('click', () => {
      video.muted = !video.muted;
      if (!video.muted && video.volume === 0) {video.volume = 0.5; vol.value = 0.5;}
      updateMuteIcon();
    });

    rate.addEventListener('change', () => {
      video.playbackRate = parseFloat(rate.value);
    });

    fsBtn.addEventListener('click', toggleFullscreen);

    // Seek interactions
    const seek = (evt) => {
      const rect = seekBar.getBoundingClientRect();
      const p = Math.min(1, Math.max(0, (evt.clientX - rect.left) / rect.width));
      if (isFinite(video.duration)) video.currentTime = p * video.duration;
    };
    seekBar.addEventListener('click', seek);
    seekBar.addEventListener('mousedown', e => {
      const move = (ev) => seek(ev);
      const up = () => {
        window.removeEventListener('mousemove', move);
        window.removeEventListener('mouseup', up);
      };
      window.addEventListener('mousemove', move);
      window.addEventListener('mouseup', up);
    });

    // Simple captions toggle placeholder (for external .vtt if you add <track> later)
    ccBtn.addEventListener('click', () => {
      const track = video.textTracks && video.textTracks[0];
      if (!track) {flash('No captions track added'); return;}
      track.mode = (track.mode === 'showing') ? 'hidden' : 'showing';
      ccBtn.style.background = track.mode === 'showing' ? '#ffffff30' : '#ffffff10';
    });

    // Theme
    themeToggle.addEventListener('change', () => {
      if (themeToggle.checked) body.classList.add('light'); else body.classList.remove('light');
    });

    // ====== FUNCTIONS ======
    function onStreamError() {
      // If Drive refuses direct bytes, offer preview fallback
      flash('Direct stream failed. Loading Drive preview iframe.');
      // Replace <video> with an iframe preview
      const iframe = document.createElement('iframe');
      iframe.src = drivePreview;
      iframe.allow = "autoplay; fullscreen";
      iframe.style = "width:100%;height:min(62vw,560px);border:0;background:#000";
      player.replaceChild(iframe, video);
      controls.remove(); // custom controls cannot control cross-origin iframe
    }

    function togglePlay() {
      if (video.paused) video.play().catch(() => { }); else video.pause();
    }
    function updatePlayIcon() {
      playBtn.textContent = video.paused ? 'â–¶' : 'â¸';
    }
    function toggleFullscreen() {
      const el = player;
      if (!document.fullscreenElement) {el.requestFullscreen?.();}
      else {document.exitFullscreen?.();}
    }
    function updateProgress() {
      if (!isFinite(video.duration)) {timeLabel.textContent = "00:00 / 00:00"; return;}
      const p = (video.currentTime / video.duration) * 100;
      fillBar.style.width = `${p}%`;
      updateTimes();
    }
    function updateBuffered() {
      try {
        if (video.buffered.length) {
          const bufferedEnd = video.buffered.end(video.buffered.length - 1);
          const pct = Math.min(100, (bufferedEnd / video.duration) * 100);
          loadBar.style.width = `${pct}%`;
        }
      } catch (e) { }
    }
    function updateTimes() {
      const cur = isFinite(video.currentTime) ? video.currentTime : 0;
      const dur = isFinite(video.duration) ? video.duration : 0;
      timeLabel.textContent = `${fmt(cur)} / ${fmt(dur)}`;
    }
    function fmt(s) {
      s = Math.max(0, Math.floor(s));
      const h = Math.floor(s / 3600);
      const m = Math.floor((s % 3600) / 60);
      const sec = s % 60;
      return (h ? String(h).padStart(2, '0') + ':' : '') + String(m).padStart(2, '0') + ':' + String(sec).padStart(2, '0');
    }
    function onKey(e) {
      if (document.activeElement?.tagName === 'INPUT' || document.activeElement?.tagName === 'SELECT') return;
      switch (e.key.toLowerCase()) {
        case ' ':
        case 'k': e.preventDefault(); togglePlay(); break;
        case 'm': video.muted = !video.muted; updateMuteIcon(); break;
        case 'f': toggleFullscreen(); break;
        case 'arrowright': video.currentTime = Math.min(video.duration, video.currentTime + 5); break;
        case 'arrowleft': video.currentTime = Math.max(0, video.currentTime - 5); break;
        case 'arrowup': video.volume = Math.min(1, video.volume + .05); vol.value = video.volume; updateMuteIcon(); break;
        case 'arrowdown': video.volume = Math.max(0, video.volume - .05); vol.value = video.volume; updateMuteIcon(); break;
        case '>': case '.': video.playbackRate = Math.min(2, (video.playbackRate + .25)); rate.value = video.playbackRate; break;
        case '<': case ',': video.playbackRate = Math.max(.5, (video.playbackRate - .25)); rate.value = video.playbackRate; break;
      }
    }
    function updateMuteIcon() {
      muteBtn.textContent = (video.muted || video.volume === 0) ? 'ðŸ”‡' : 'ðŸ”ˆ';
    }
    function flash(msg) {
      const el = document.createElement('div');
      el.textContent = msg;
      el.style = "position:absolute;left:50%;top:10px;transform:translateX(-50%);background:#000c;color:#fff;padding:8px 12px;border-radius:8px;font-size:12px;z-index:5";
      player.appendChild(el);
      setTimeout(() => el.remove(), 2400);
    }

    // Optional: add a captions track later by uncommenting below and hosting a VTT file
    // const track = document.createElement('track');
    // track.kind = "subtitles"; track.label = "English"; track.srclang = "en";
    // track.src = "subtitles.vtt"; // ensure CORS-allowed hosting
    // video.appendChild(track);
  </script>
</body>

</html>
